{% extends "editor/layout.html.twig" %}

{% block javascript %}
    {{ parent() }}
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
{% endblock %}

{% block bodyId %}articulos{% endblock %}

{% block bodyIncludes %}{% include "ComurImageBundle:Form:croppable_image_modal.html.twig" with {'include_jquery': false, 'include_bootstrap': false} %}{% endblock %}

{% block siteActionHeader %}
<span class="col-12 pad">
    <h1 class="titulo cuerpo tam38 rojo-500">Edición de Artículo</h1>
</span>
{% endblock %}

{% block siteActionContent %}
<form class="col-12 clear" action="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) }}" {{ form_enctype(form) }} method="POST">
    <span class="col-6 pad">
        {{ form_label(form.title, "Título del Artículo") }}
        {{ form_errors(form.title) }}
        {{ form_widget(form.title, { 'attr': { 'class': 'texto grande' } }) }}

        {{ form_label(form.pretitle, "Antetítulo") }}
        {{ form_errors(form.pretitle) }}
        {{ form_widget(form.pretitle, { 'attr': { 'class': 'texto' } }) }}

        {% for subtitle in form.subtitles %}
        {{ form_label(subtitle, "Subtítulo "~loop.index) }}
        {{ form_errors(subtitle) }}
        {{ form_widget(subtitle, { 'attr': { 'class': 'texto' } }) }}
        {% endfor %}

        {{ form_label(form.intro, "Entradilla") }}
        {{ form_errors(form.intro) }}
        {{ form_widget(form.intro, { 'attr': { 'rows': '3' } }) }}

        {{ form_label(form.text, "Texto del Artículo") }}
        {{ form_widget(form.text, { 'attr': { 'class': 'tinymce', 'rows': '30' } }) }}
        {{ tinymce_init() }}
    </span>
    <span class="col-3 pad">
        {% set primaryImages = [] %}
        {% set textImages = [] %}
        {% set videos = [] %}
        {% set audios = [] %}
        {% for multimediaObject in form.multimedias %}
            {% if multimediaObject.vars.value.type == 'image' and multimediaObject.vars.value.position == 'primary' %}
                {% set primaryImages = primaryImages|merge([multimediaObject]) %}
            {% elseif multimediaObject.vars.value.type == 'image' %}
                {% set textImages = textImages|merge([multimediaObject]) %}
            {% elseif multimediaObject.vars.value.type == 'video' %}
                {% set videos = videos|merge([multimediaObject]) %}
            {% elseif multimediaObject.vars.value.type == 'audio' %}
                {% set audios = audios|merge([multimediaObject]) %}
            {% endif %}
        {% endfor %}

        <legend class="titulo tam24 cuerpo rojo-500">Imagen principal</legend>
        {% for multimedia in primaryImages %}
        {% set formHtml =
            form_label(multimedia.image, "O sube una imagen")
            ~ form_errors(multimedia.image)
            ~ form_widget(multimedia.image, { 'attr':{ 'tabindex': '-1' } })
        %}
        <div id="primary_image_form_{{ loop.index }}">
        {% if multimedia.vars.data.path is defined and multimedia.vars.data.path|length > 0 %}
        <label>Imagen Principal</label>
        <span class="caja-imagen">
            <span class="tarjeta imagen">
                <img alt="" src="{{ relative_images_path|replace({'{site_domain}': currentSite.slug}) ~ multimedia.vars.data.path }}">
                <span class="botones der">
                    <a class="boton cuadrado blanco descartar" id="remove_primary_image_{{ loop.index }}" href="#">
                        <span class="icono icon icon-eliminar"></span>
                    </a>
                </span>
            </span>
        </span>
        {{ form_widget(multimedia.path, { 'attr':{ 'hidden': 'true' } }) }}
        {% else %}
            {{ formHtml|raw }}
        {% endif %}
        </div>
        {#<script>
            jQuery("#remove_primary_image_{{ loop.index }}").click(function(){
                if (window.confirm("¿Seguro que desea borrar la imagen?")) {
                    jQuery("#primary_image_form_{{ loop.index }}").html('{{ formHtml|raw }}');
                    $("#{{ multimedia.image.vars.id }}").jfilestyle({
                        buttonText: "<span class='icon icon-subir'></span>"
                    });
                }
            });
        </script>#}
        {% endfor %}

        <legend class="titulo tam24 cuerpo rojo-500">Imágenes en texto</legend>
        {% for multimedia in textImages %}
        {% set formHtml = 
            form_label(multimedia.image, "Subir la imagen en texto "~loop.index)
            ~ form_errors(multimedia.image)
            ~ form_widget(multimedia.image, { 'attr':{ 'tabindex': '-1' } })
        %}
        <div id="text_image_form_{{ loop.index }}">
        {% if multimedia.vars.data.path is defined and multimedia.vars.data.path|length > 0 %}
            <label>Imagen en Texto {{ loop.index }}</label>
            <span class="caja-imagen">
                <span class="tarjeta imagen">
                    <img alt="" src="{{ relative_images_path|replace({'{site_domain}': currentSite.slug}) ~ multimedia.vars.data.path }}">
                    <span class="botones der">
                        <a class="boton cuadrado blanco descartar" id="remove_text_image_{{ loop.index }}" href="#">
                            <span class="icono icon icon-eliminar"></span>
                       </a>
                    </span>
                </span>
                {{ form_widget(multimedia.path, { 'attr':{ 'hidden': 'true' } }) }}
            </span>
        {% else %}
            {{ formHtml|raw }}
        {% endif %}
        </div>
        {#<script>
            jQuery("#remove_text_image_{{ loop.index }}").click(function(){
                if (window.confirm("¿Seguro que desea borrar la imagen?")) {
                    jQuery("#text_image_form_{{ loop.index }}").html('{{ formHtml|raw }}');
                    $("#{{ multimedia.image.vars.id }}").jfilestyle({
                        buttonText: "<span class='icon icon-subir'></span>"
                    });
                }
            });
        </script>#}
        {% endfor %}

        <legend class="titulo tam24 cuerpo rojo-500">Sumarios</legend>
        {% for summary in form.summaries %}
            {{ form_label(summary, "Sumario "~loop.index) }}
            {{ form_errors(summary) }}
            {{ form_widget(summary, { 'attr': { 'class': 'texto' } }) }}
        {% endfor %}

        <legend class="titulo tam24 cuerpo rojo-500">Vídeo</legend>
        {% for multimedia in videos %}
        {{ form_label(multimedia.htmlCode, "Código del reproductor de vídeo") }}
        {{ form_errors(multimedia.htmlCode) }}
        {{ form_widget(multimedia.htmlCode, { 'attr': { 'rows': '2' } }) }}
        {% endfor %}

        <legend class="titulo tam24 cuerpo rojo-500">Audio</legend>
        {% for multimedia in audios %}
        {{ form_label(multimedia.htmlCode, "Código del reproductor de audio") }}
        {{ form_errors(multimedia.htmlCode) }}
        {{ form_widget(multimedia.htmlCode, { 'attr': { 'rows': '2' } }) }}
        {% endfor %}
    </span>
    <span class="col-3 pad">
        <legend class="titulo tam24 cuerpo rojo-500">Etiquetado</legend>
        {{ form_label(form.sectionId, "Sección") }}
        {{ form_errors(form.sectionId) }}
        {{ form_widget(form.sectionId) }}
        <label for="" class="check">{{ form_widget(form.useCategoryAsPretitle) }}Usar nombre de la sección como antetítulo</label>

        <label for="etiquetas">Guardado en:</label>
        <span class="guardado-en">
            <span class="cat" id="categories_selection">
                {% for option in form.categoryIds %}
                <label for="" class="check">{{ form_widget(option) }}{{ option.vars.label }}</label>
                {% endfor %}
            </span>
            <span class="tag">
                {% for option in form.tagIds %}
                <label for="" class="check">{{ form_widget(option) }}{{ option.vars.label }}</label>
                {% endfor %}
            </span>
        </span>

        <span class="botones">
            {{ form_widget(form.publish, { 'label': "Publicar", 'attr': { 'type': 'submit', class: 'boton azul' } }) }}
            {{ form_widget(form.save, { 'label': "Guardar Borrador", 'attr': { 'type': 'submit', class: 'boton negro' } }) }}
            <!-- === button type="submit" value="publish" class="boton azul"><span class="accion">Publicar</span></button>
            <button type="submit" value="save" class="boton negro"><span class="accion">Guardar borrador</span></button === -->
        </span>
    </span>
    {{ form_widget(form._token) }}
</form>
{% endblock %}

{# block bodyJs %}
    {{ parent() }}
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
{% endblock #}
