{% extends "editor/layout.html.twig" %}

{% block bodyId %}secciones{% endblock %}

{% block siteActionHeader %}
<span class="col-12 pad">
    <h1 class="titulo cuerpo tam38 rojo-500">Edición de Secciones</h1>
</span>
{% endblock %}

{% block siteActionContent %}
{% if is_granted('ROLE_ADMIN') %}
<span class="col-5 pad">
    <form class="col-12 clear" action="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) }}" {{ form_enctype(form) }} method="POST">
        {{ form_label(form.name, "Nombre de la Categoría") }}
        {{ form_errors(form.name) }}
        {{ form_widget(form.name, { 'attr': { 'class': 'texto grande' } }) }}

        {{ form_label(form.slug, "Slug de la Categoría") }}
        {{ form_errors(form.slug) }}
        {{ form_widget(form.slug, { 'attr': { 'class': 'texto' } }) }}

        {{ form_label(form.metaTitle, "Meta Title de la Categoría") }}
        {{ form_errors(form.metaTitle) }}
        {{ form_widget(form.metaTitle, { 'attr': { 'class': 'texto' } }) }}

        {{ form_label(form.description, "Descripción de la Categoría") }}
        {{ form_errors(form.description) }}
        {{ form_widget(form.description, { 'attr': { 'rows': '3' } }) }}

        {{ form_label(form.parentId, "Padre de la Categoría") }}
        {{ form_widget(form.parentId) }}

        {{ form_widget(form.save, { 'label': "Guardar", 'attr': { 'type': 'submit', class: 'boton azul' } }) }}
        {{ form_widget(form._token) }}
    </form>
</span>
<span class="col-7 pad">
    <table>
        <tbody>
            <tr>
                <th>Nombre</th>
                <th>Slug</th>
                <th>Editar</th>
                <th></th>
            </tr>
            {{ listsMacros.categories_table(currentSite, categories) }}
        </tbody>
    </table>
</span>
{% endif %}
<span class="col-6 pad">
    <legend class="titulo tam24 cuerpo rojo-500">Categorías Destacadas</legend>
    <div class="droppable-container" id="contents-added" ondrop="drop(event)" ondragover="allowDrop(event)">
    {% for content in outstandingCategories %}
        <div id="{{ content.id }}" class="elemento elemento-seccion" draggable="true" ondragstart="drag(event)">{{ content.name }}</div>
    {% endfor %}
    </div>
</span>
<span class="col-6 pad">
    <legend class="titulo tam24 cuerpo rojo-500">Categorías Disponibles</legend>
    <div class="droppable-container" id="contents-list" ondrop="drop(event)" ondragover="allowDrop(event)">
    {% for content in notOutstandingCategories %}
        <div id="{{ content.id }}" class="elemento elemento-seccion" draggable="true" ondragstart="drag(event)">{{ content.name }}</div>
    {% endfor %}
    </div>
</span>
<form method="POST" id="outstandingsForm" action="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) }}">
    <input id="outstandingsConfig" name="outstandings" type="hidden" />
    <button type="submit" name="submit" value="set" class="boton azul"><span class="accion">Guardar Destacadas</span></button>
</form>
{% endblock %}

{% block bodyJs %}
{{ parent() }}
<script>
    $('#outstandingsForm').submit(function(){
        var arrayOutstandings = new Array();
        var outstandings = $('#contents-added');
        outstandings.children(".elemento").each(function(){
            arrayOutstandings.push($(this).attr('id'));
        });
        jsonOutstandings = JSON.stringify(arrayOutstandings);
        $('#outstandingsConfig').val(jsonOutstandings);

        return true;
    });
    function drop(ev)
    {
        ev.preventDefault();
        if (ev.target.className == "droppable-container") {
            var data = ev.dataTransfer.getData("text");
            ev.target.appendChild(document.getElementById(data));
        }
    }

    function allowDrop(ev)
    {
        ev.preventDefault();
    }
    function drag(ev)
    {
        ev.dataTransfer.setData("text", ev.target.id);
    }
</script>
{% endblock %}
